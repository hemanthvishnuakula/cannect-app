# Stream module config to proxy HTTPS to Caddy for user handles
# This goes in /etc/nginx/nginx.conf under the stream {} block

stream {
    map $ssl_preread_server_name $backend {
        feed.cannect.space   127.0.0.1:8443;
        push.cannect.space   127.0.0.1:8443;
        cannect.space        127.0.0.1:8443;
        default              127.0.0.1:8443;  # User handles go to Caddy
    }

    server {
        listen 443;
        ssl_preread on;
        proxy_pass $backend;
    }
}
